!function(t,n){"use strict";var e={doAction:function(e,a,o,i,l,r,s,c){var u=U.pagedataBlob()||{},d=(u.cfg,null),f=Identities.bmgr.bands().length>0,m=Identities.fan()&&!Identities.fan().private&&!Identities.fan().verified;if("wishlist"===e?d=m?"unverified_fan_wishlist_open":f?"logged_out_wishlist_open_band_no_fan":"logged_out_wishlist_open":"follow"===e&&"f"===l?d=m?"unverified_fan_fan_follow_open":f?"logged_out_fan_follow_open_band_no_fan":"logged_out_fan_follow_open":"follow"!==e||l&&"b"!==l?"follow"!==e||l&&"g"!==l?"live_ticket"!==e&&"live_attend"!==e&&"live_attend_immediate"!==e||(d=f?"logged_out_live_ticket_purchase_open_band_no_fan":"logged_out_live_ticket_purchase_open"):d=m?"unverified_fan_follow_open":f?"logged_out_follow_open_band_no_fan":"logged_out_genre_follow_open":d=m?"unverified_fan_follow_open":f?"logged_out_follow_open_band_no_fan":"logged_out_follow_open",d&&Stats.record({kind:"click",click:d}),"wishlist"===e||"follow"===e&&"b"===l){var p={click_type:e,item_id:i,item_type:l,user_type:"guest"};BCTracker.record("click",p)}0===(a=a||"").length&&u.signup_querystrings&&(a=u.signup_querystrings[l+i]||"");var g,_,b=o||("follow"==e?"loflwlgn":"lowllgn"),w=o||("follow"==e?"loflwlrn":"lowllrn");if(a.length>0?(g=siteroot_https+"/login"+a+"&action="+e+"&from="+b,_=siteroot_https+"/fans"+a+"&action="+e+"&from="+w):(g=siteroot_https+"/login?action="+e+"&from="+b,_=siteroot_https+"/fans?action="+e+"&from="+w),Identities.fan()&&!Identities.fan().private&&!Identities.fan().verified&&t.VerifyNag){var h=u.signup_params.email||t.FanSignup.state.email;t.verifyNag=t.verifyNag||new VerifyNag({fan_email:h}),t.verifyNag.openDialog()}else if(t.FanSignup){var y=(!Identities.fan()||Identities.fan().private)&&Identities.user();if("phone"===MediaView.mode&&y){var v=siteroot_https+"/fan_signup"+a+"&action="+e+"&from="+w+"&pane=existing_artist";t.location.href=v}else if(Url.isCustomDomain()&&y)if(FanSignup.subdomainURL){var C={fan_action_pane:"existing_artist",fan_action:e};t.location.href=Url.addQueryParams(FanSignup.subdomainURL,C)}else t.location.href=siteroot_https+"/fans";else{var k;FanSignup.actionParams={action:e},i&&l?(FanSignup.actionParams.actionItemId=i,FanSignup.actionParams.actionItemType=l,FanSignup.actionParams.actionBandId=r):r&&(FanSignup.actionParams.actionBandId=r),s&&(FanSignup.actionParams.collectData=s),c&&(FanSignup.actionParams=n.extend({},FanSignup.actionParams,c)),FanSignup.actionParams.from=o,FanSignup.actionParams.queryString=a,k=y&&FanSignup.affiliations&&(FanSignup.affiliations.fan||FanSignup.affiliations.fan_already_linked_email)?"dupe_fan":y?"existing_artist":"action",FanSignup.openPane(k,!0)}}else{var F;"wishlist"==e?F=TM("Wishlist"):"follow"===e&&(F=TM("Follow"));var T={title:F,buttons:[],minHeight:100};"desktop"===MediaView.mode&&(T.width="38em"),NuDialog.showTemplate("fan/fan_action_panel",{siteroot:t.siteroot,is_band_member:Identities.bmgr.bands().length>0,action:e,loginUrl:g,signupUrl:_},T)}}};t.FanAction=e,n(document).ready((function(){var e=Url.parseQuery(location.search),a=n("#pagedata").data("blob")||{};a.cfg;if(e.show_nag){var o=a.signup_params.email||t.FanSignup.state.email;t.verifyNag=t.verifyNag||new VerifyNag({fan_email:o}),t.verifyNag.openDialog(),SignupUtils.cleanURL()}n(document).on("visibilitychange",(function(){document.visibilityState&&"visible"===document.visibilityState&&!Identities.user()&&Cookie.get("js_logged_in")&&t.location.reload(!0)}))}))}(window,jQuery);var FanControls={Data:null,start:function(t){FanControls._started||(FanControls._started=!0,FanControls._cfg=U.pagedataBlob().cfg||{},FanControls._identities=U.pagedataBlob().identities,FanControls._isFan=!!Identities.fan(),t?FanControls.data=t:FanControls.getData())},getData:function(){var t=$.Deferred();if(Log.debug("FanControls.getData: data is "+(FanControls.Data?"present":"not yet present")),FanControls.Data)t.resolve(FanControls.Data);else{if(FanControls._data_promise)return FanControls._data_promise;FanControls._data_promise=t.promise(),FanControls._isFan?$.ajax({type:"GET",url:"/api/fan/2/collection_summary",dataType:"json"}).then((function(n){Log.debug("FanControls.getData: xhr finished"),FanControls.Data=n,FanControls._data_promise=null,t.resolve(n)})):(FanControls._data_promise=null,t.reject())}return t.promise()},attach:function(t){$(t).find(".wishlist-msg, .wishlisted-msg").click(FanControls.wishlist_click),$(t).find(".follow-fan").click(FanControls.followfan_click)},delegate:function(t){$(t).on("click",".collect-item .wishlist-msg, .collect-item .wishlisted-msg",FanControls.wishlist_click),$(t).on("click",".follow-fan",FanControls.followfan_click),$(t).on("mouseenter mouseleave",".following",(function(t){"mouseenter"==t.type?$(".following-msg",this).html(TM("Unfollow")):"mouseleave"==t.type&&$(".following-msg",this).html(TM("Following"))}))},wishlist_click:function(t){if(!t.target||!$(t.target).hasClass("view")){var n=FanControls.findContainer(this,"collect-item");if(!Identities.fan()||Identities.fan()&&!Identities.fan().verified&&!n.hasClass("wishlisted"))return t.preventDefault(),void FanControls.signup_or_verify_wishlist_click(n);n&&n.hasClass("disabled")?t.preventDefault():FanControls._isFan&&FanControls.getData().then((function(){if(t.preventDefault(),FanControls.Data){var e=FanControls.collectParams(n);if(e)if(FanControls.Data&&!FanControls.Data.read_only){var a=n.hasClass("wishlisted"),o=n.attr("data-collect-stat");if(!a&&o&&Stats.record({kind:"click",click:o}),FanControls.Data.fan_id){var i=FanControls.matchingContainers(n,"collect-item","collect-item");i.toggleClass("wishlisted"),FanControls.toggleItem(e);if(FanControls.doPost(a?"/uncollect_item_cb":"/collect_item_cb",e,(function(t){t.ok?Log.note("item "+(a?"removed":"added")+" from wishlist"):(i.toggleClass("wishlisted"),FanControls.toggleItem(e))})),!a)if($("#pagedata").data("blob").is_corp_home&&window.FanOnboarding&&window.FanOnboarding.showFirstWishlistTooltip&&0===$(".signup-tooltip-parent.show-tooltip").length&&"phone"!==MediaView.mode){window.FanOnboarding.setFirstWishlistedItem(e.item_title,e.item_type);var l=$("#pagedata").data("blob").identities;window.SignupUtils.renderHeader(FanControls.identities,{has_collection:window.FanOnboarding.hasCollection,user_type:"fan",fan_name:l.fan.name,collection_url:l.fan.url,band_url:Identities.bmgr.bands().length>0?Identities.bmgr.bands()[0].trackpipeUrl():null},{action:"wishlist"}),window.FanOnboarding.showTooltip("w"),$("body").removeClass("scroll-detected"),$("body").addClass("prevent-header-hiding"),window.FanOnboarding.showFirstWishlistTooltip=!1}}else NuDialog.alertHTML("Login Required","Please <a href='"+Text.escapeHtml(siteroot_https)+"/login'>log in</a> to wishlist this "+("a"==e.item_type?"album":"track")+". Don't have a fan account yet? <a target='_blank' href='/fans'>Learn more</a>.")}else NuDialog.alert("Unavailable","Oops! Wishlists are currently unavailable. Please try again later.");else Log.debug("bad tralbum data on wishlist control")}else Log.debug("no FanControls.Data, why are we here?")}))}},signup_or_verify_wishlist_click:function(t){var n=t.data("lo-querystr")||"",e=t.data("lo-from"),a=this.collectParams(t);a&&FanAction.doAction("wishlist",n,e,a.item_id,a.item_type,a.band_id,a)},followfan_click:function(t){var n=FanControls.findContainer(this,"follow-fan");if(n.hasClass("disabled"))t.preventDefault();else{if(!(Identities.fan()&&Identities.fan().verified||n.hasClass("following")))return t.preventDefault(),void FanControls.signup_or_verify_followfan_click(n);if(FanControls._isFan){var e=$(t.target).closest("a").attr("href");if("#"===e||-1!==e.indexOf("/fans"))if(t.preventDefault(),FanControls.Data){var a=FanControls.followFanParams(n);if(a)if(FanControls.Data&&!FanControls.Data.read_only){var o=n.hasClass("following"),i=n.attr("data-follow-stat");if(!o&&i&&Stats.record({kind:"click",click:i}),FanControls.Data.fan_id){var l=FanControls.matchingContainers(n,"follow-fan","follow-fan");l.toggleClass("following"),FanControls.toggleFan(a);FanControls.doPost("/fan_follow_cb",a,(function(t){1==t.ok?(Log.note("fan "+(o?"removed":"added")+" from follows"),$("body").trigger("fan_"+(o?"unfollow":"follow")+"ed",[a.follow_id])):(l.toggleClass("following"),FanControls.toggleFan(a))}))}else NuDialog.alertHTML("Login Required","Please <a href='"+Text.escapeHtml(siteroot_https)+"/login'>log in</a> to follow this fan. Don't have a fan account yet? <a target='_blank' href='/fans'>Learn more</a>.")}else NuDialog.alert("Unavailable","Oops! Wishlists are currently unavailable. Please try again later.");else Log.debug("bad fan data on follow-fan control")}else Log.debug("no FanControls.Data, why are we here?")}}},signup_or_verify_followfan_click:function(t){var n=this.followFanParams(t);n&&FanAction.doAction("follow",null,null,n.follow_id,"f",null,n)},doPost:function(t,n,e){Url.isCustomDomain()&&(t=siteroot_current+t),Crumb.ajax({type:"POST",url:t,data:n,dataType:Url.isCustomDomain()&&!$.support.cors?"jsonp":"json",xhrFields:{withCredentials:!0},success:function(t){e(t),!0===t.ok?Log.debug("XHR form submission succeeded with data",t):Log.error("XHR POST returned error JSON",t)},error:function(t,n,e){Log.error("XHR POST failed",t,n,e)}})},findContainer:function(t,n){return container=$(t).closest("."+n),0==container.length?(Log.debug("missing fan-controls container"),null):container},matchingContainers:function(t,n,e){return $("."+n+"[data-"+e+"="+t.attr("data-"+e)+"]")},getTralbumLookup:function(t){return FanControls.Data&&FanControls.Data.collection_summary&&FanControls.Data.collection_summary.tralbum_lookup?FanControls.Data.collection_summary.tralbum_lookup[t]:null},isFollowedFan:function(t){return FanControls.Data&&FanControls.Data.collection_summary&&FanControls.Data.collection_summary.follows&&FanControls.Data.collection_summary.follows.following?(FanControls.Data.collection_summary.follows.following||{})[t]:null},setTralbumLookup:function(t,n){FanControls.Data&&FanControls.Data.collection_summary&&FanControls.Data.collection_summary.tralbum_lookup||Log.error("attempting to set tralbum lookup with no data!"),FanControls.Data.collection_summary.tralbum_lookup[t]=n},initializeItems:function(t){var n=$(t||document);if(!FanControls._isFan)return n.find(".collect-item").removeClass("disabled"),void n.find(".follow-button").removeClass("disabled");Log.debug("FanControls.initializeItems getting data"),FanControls.getData().then((function(t){Log.debug("FanControls.initializeItems got data, doing some stuff");var e=t&&t.collection_summary,a=e&&e.tralbum_lookup,o=e&&e.follows&&e.follows.following;a?n.find(".collect-item").each((function(t,n){var e=$(n),o=e.attr("data-collect-item"),i=a[o];i?i.purchased?(e.addClass("purchased"),e.removeClass("wishlisted")):(e.addClass("wishlisted"),e.removeClass("purchased")):e.removeClass("purchased").removeClass("wishlisted"),e.removeClass("disabled")})):Log.error("trying to render fan state but collection_summary data not found. Data:",t),o?n.find(".follow-button").each((function(t,n){var e=$(n),a=e.data("follow-fan");o[a]?e.addClass("following"):e.removeClass("following"),e.removeClass("disabled")})):Log.error("trying to render fan state but following data not found.  Data:",t)}))},toggleItem:function(t){if(FanControls.Data&&!FanControls.Data.read_only){var n=t.item_type+t.item_id,e=FanControls.getTralbumLookup(n);e?e.purchased||FanControls.setTralbumLookup(n,null):FanControls.setTralbumLookup(n,{item_type:t.item_type,item_id:t.item_id,band_id:t.band_id,purchased:null})}},toggleFan:function(t){if(FanControls.Data&&!FanControls.Data.read_only){var n=t.follow_id.toString(),e=FanControls.Data.collection_summary.follows.following,a=e[n];e[n]=!a||null}},collectParams:function(t){if(!t)return null;var n=FanControls.Data?FanControls.Data.fan_id:null,e=t.attr("data-collect-band"),a=t.attr("data-collect-item")||"",o=t.attr("data-booyakasha-user")||null,i=a.substr(0,1),l=parseInt(a.substr(1)),r=t.attr("data-collect-context")||null,s=t.attr("data-ref-hint")||null,c=t.attr("data-collect-stat")||null,u=t.attr("data-collect-title")||null;if(isNaN(l))return Log.debug("bad or missing item spec for collect controls: "+a),null;var d={fan_id:n,item_id:l,item_type:i,band_id:e,context:r};return s&&(d.ref_hint=s),u&&(d.item_title=u),window.ReferrerToken&&(d.ref_token=window.ReferrerToken),o&&(d.ref_username=o),c&&(d.stat_token=c),d},followFanParams:function(t){if(!t)return null;var n=FanControls.Data?FanControls.Data.fan_id:null,e=t.attr("data-follow-fan"),a=t.hasClass("following")?"unfollow":"follow",o=t.attr("data-follow-stat");return isNaN(e)?(Log.debug("bad or missing item spec for follow-fan controls"),null):(params={fan_id:n,follow_id:e,action:a},o&&(params.stat_token=o),params)},zzz:null};!1!==window.FanControlsAutoStart&&$(document).ready((function(){FanControls.start()})),function(t,n,e){"use strict";var a={isWishlisted:function(t,n){var e=FanControls.getTralbumLookup(t+n);return e&&!e.purchased},isFollowedFan:function(t){return FanControls.isFollowedFan(t)},wishlist:function(e,a,o,i){var l=this;if(!Identities.fan()||t.Tralbum&&Identities.fan().private)t.Tralbum&&FanAction.doAction("wishlist",U.pagedataBlob().lo_querystr||"",null,a,e,o);else{if(t.Tralbum||!t.TralbumData||!TralbumData.current||!TralbumData.current.id){var r={fan_id:Identities.fan().id,item_type:e,item_id:a,band_id:o,purchased:null};i&&n.each(i,(function(t,n){i[t]&&(r[t]=n)}));var s=n('.collect-item[data-collect-item="'+e+a+'"]');n.merge(s,n('.collection-item-container[data-tralbumid="'+a+'"][data-tralbumtype="'+e+'"]'));var c=function(){FanControls.toggleItem(r),s.toggleClass("wishlisted"),BCEvents.publish("fanControls.wishlist.toggle")};return FanControls._started=!1,FanControls.start(),FanControls.initializeItems(),FanControls.getData().then((function(){var t=l.isWishlisted(e,a);!t&&r.stat_token&&Stats.record({kind:"click",click:r.stat_token}),c(),FanControls.doPost(t?"/uncollect_item_cb":"/collect_item_cb",r,(function(n){!0===n.ok?Log.note("item "+(t?"removed":"added")+" from wishlist"):c()}))}))}FanControls.collectItem(Identities.fan().id,TralbumData.current.id,TralbumData.current.type,TralbumData.current.band_id)}},followBand:function(e,a,o){var i=t.BandData||null;if(!t.Tralbum||Identities.fan()&&!Identities.fan().private)if(i)BandFollow.followUnfollow(Identities.fan().id,i.id,TralbumData.current?TralbumData.current.id:null,TralbumData.current?TralbumData.current.type:null,a,o);else{var l={band_id:e,fan_id:Identities.fan().id,action:o?"unfollow":"follow"},r=n('.follow-band[data-follow-band="'+e+'"]');n.merge(r,n("#follow-unfollow-band_"+e));var s=function(){n(".following-msg",r).html(TM("Following")),r.toggleClass("following"),BCEvents.publish("fanControls.followBand.toggle")};FanControls._started=!1,FanControls.start(),FanControls.initializeItems(),FanControls.getData().then((function(){s(),FanControls.doPost("/fan_follow_band_cb",l,(function(t){!0===t.ok?Log.note("fan followed"):s()}))}))}else FanAction.doAction("follow",U.pagedataBlob().lo_querystr||"",null,e,"b",e);BCEvents.publish("fanControls.followBand")},followFan:function(t,e){var a=this,o={fan_id:Identities.fan().id,follow_id:t};e&&n.each(e,(function(t,n){e[t]&&(o[t]=n)}));var i=n('.follow-fan[data-follow-fan="'+t+'"]');n.merge(i,n("#follow-unfollow_"+t)),FanControls._started=!1,FanControls.start(),i.addClass("following"),FanControls.getData().then((function(){FanControls.initializeItems(),i.addClass("following");var n=a.isFollowedFan(t);!n&&o.stat_token&&Stats.record({kind:"click",click:o.stat_token}),FanControls.toggleFan(o),FanControls.doPost("/fan_follow_cb",o,(function(t){!0===t.ok&&Log.note("fan "+(n?"followed":"unfollowed"))}))}))}};t.FanControls2=a}(window,$,ko);var Fanpage={};!function(t){"use strict";var n;$(document).ready((function(){var t=$("#pagedata").data("blob");n=$("#fan-container")[0],PopupImage.delegate(n),PopupImage.attach("a.showmeProfilePhoto"),PopupImage.attach("a.showmeJustification"),$(n).on("click",".collection-item-actions .wishlist-msg",(function(n){var e=$(this).parents(".collection-item-container"),a=e.data("tralbumid"),o=e.data("tralbumtype"),i=e.data("bandid"),l=e.data("title");!Identities.fan()||Identities.fan()&&!Identities.fan().verified?FanAction.doAction("wishlist",t.lo_querystr||"",null,a,o,i):Fanpage.collectItem(a,o,i,l,this)})),$(n).on("click",".collection-item-actions .wishlisted-msg",(function(t){var n=$(this);if(!n.closest(".signup-tooltip-parent").hasClass("show-tooltip")){var e=n.parents(".collection-item-container"),a=e.data("itemid"),o=e.data("ispurchasable");Fanpage.uncollectItem(a,this,!o)}})),$(n).on("click",".preference-container .open-prefs",(function(t){t.stopImmediatePropagation(),FollowGrids.followingGenres.openGenrePicker()})),$(".followingnoteclose").click((function(){$(".following-note").slideUp(200)})),$(n).on("click",".share-link",(function(t){var n=$(this).data("itemtype"),e=$(this).data("itemid"),a={},o={linkback:(a=$(this).data("isgiftsgiven")?CollectionGrids.giftsGiven.itemCache[n[0]+e+"g"]:CollectionGrids.collection.itemCache[n[0]+e]).item_url,is_track:"t"===a.tralbum_type,title:a.item_title,artist:a.band_name},i=TM("Share"),l=NuDialog.showTemplate("_share_tralbum_phone",o,{title:i,buttons:{}});return SocialControls.initFromDOM(l),!1})),!window.MediaView||"desktop"!=window.MediaView.mode||"iphone"!=Browser.platform&&"android"!=Browser.platform||$(".collection-grid").addClass("tablet"),"undefined"!=typeof CurrentFan&&CurrentFan.is_own_collection&&Stats.record({kind:"fan view "+("desktop"===MediaView.mode?"desktop":"mobile")})})),t.toggleAlsoCollectedBy=function(t){var n=$(t).closest(".collected-by").find(".deets");if(n.hasClass("populated"))n.toggle();else{var e=n.closest(".collection-item-container"),a=e.data("tralbumtype"),o=e.data("tralbumid"),i=$(".also-link",$(t).closest(".collected-by")),l=new FanTralbumCollectors(n,a,o,"collection");l.renderFull().then((function(){"phone"===MediaView.mode&&0===l.thumbs.length&&1===l.reviews.length&&i.closest(".collected-by-header").text(TM("supported by",null,"people that have purchased this item"))})),"phone"===MediaView.mode&&i.removeClass("item-link also-link").addClass("not-a-link")}},t.collectItem=function(t,n,e,a,i){var l={};if(null!==CurrentFan&&"undefined"!=typeof CurrentFan&&null!==CurrentFan.fan_id){if(l.fan_id=CurrentFan.fan_id,l.item_id=t,l.item_type=n,l.band_id=e,CurrentFan.is_own_collection||(l.ref_username=FanData.username),$(i).closest(".collection-item-container").find(".collection-item-actions").addClass("wishlisted").removeClass("wishlist"),o("/collect_item_cb",l,(function(){CurrentFan.collection_count++,$("#menubar-collection-count").html(CurrentFan.collection_count)})),FanOnboarding.showFirstWishlistTooltip&&0===$(".signup-tooltip-parent.show-tooltip").length&&"phone"!==MediaView.mode){FanOnboarding.setFirstWishlistedItem(a,l.item_type),FanOnboarding.showFirstWishlistTooltip=!1;var r=$(i).closest(".signup-tooltip-parent")[0];window.FanOnboarding.showTooltip("x",r)}var s={click_type:"wishlist",item_id:t,item_type:n,user_type:"fan"};BCTracker.record("click",s)}},t.uncollectItem=function(t,n,e){var a={};if(null!==CurrentFan&&"undefined"!=typeof CurrentFan&&null!==CurrentFan.fan_id){e=void 0!==e&&e,a.fan_id=CurrentFan.fan_id,a.item_id=t,$(n).closest(".collection-item-container").find(".collection-item-actions").addClass("wishlist").removeClass("wishlisted"),o("/uncollect_item_cb",a,(function(){CurrentFan.collection_count--,$("#menubar-collection-count").html(CurrentFan.collection_count),e&&$(n).closest(".collection-item-controls").empty()}));var i={click_type:"unwishlist",item_id:a.item_id,item_type:a.item_type,user_type:"fan"};BCTracker.record("click",i)}},t.showHideComments=function(t){$("#comments-container_"+t).toggleClass("hidden"),$("#collection-item-container_"+t).toggleClass("active")},t.featureAccount=function(){o("/feature_fan_cb",{fan_id:FanData.fan_id,feature:1},(function(){location.reload()}))},t.cancelSubscription=function(t){var n=$(t.target),e=n.data("sub-id"),a=n.data("band-id"),o=n.data("band-name");NuDialog.alert("Cancel Subscription","Are you sure you want to cancel this fan's subscription to "+o+"? They will keep their content but immediately lose access to other subscription features.",{buttons:{"Do it":function(){Crumb.ajax({url:"/api/artistsub/1/admin_cancel_sub",data:{fan_id:FanData.fan_id,sub_id:e,band_id:a},dataAs:"JSON",type:"POST",success:function(t){window.location.reload()},error:function(t,n,e){Log.error("Cancel subscription error: ",n,e)}}),$(this).dialog("close")},"No don't":function(){$(this).dialog("close")}}})},t.nukeSubscription=function(t){var n=$(t.target),e=n.data("sub-id"),a=n.data("band-id"),o=n.data("band-name");NuDialog.alert("Nuke Subscription","Are you sure you want to nuke this fan's subscription to "+o+"?\n This will also remove any collection items associated with this subscription.",{buttons:{"Do it":function(){Crumb.ajax({url:"/api/artistsub/1/admin_nuke",data:{fan_id:FanData.fan_id,sub_id:e,band_id:a},dataAs:"JSON",type:"POST",success:function(t){window.location.reload()},error:function(t,n,e){Log.error("Nuke subscription error: ",n,e)}}),$(this).dialog("close")},"No don't":function(){$(this).dialog("close")}}})},t.unfeatureAccount=function(){o("/feature_fan_cb",{fan_id:FanData.fan_id},(function(){location.reload()}))};var e=!1;function a(t){var n=[],e="nu-dialog mailing-list-opt-in blank-title";t.label_id?(e+=" label",n=[{text:TM("Done"),click:function(){var n=$("#notify-me-band").prop("checked"),e=$("#notify-me-label").prop("checked");if(e||n){var a={address:t.email_address};n&&(a.band_id=t.band_id),e&&(a.label_id=t.label_id),Crumb.ajax({type:"POST",url:"/band_follow_email_opt_in_cb",data:a,dataType:"json",success:function(t){},error:function(t,n,e){},complete:function(){}})}$(this).dialog("close")}}]):(e+=" band",n=[{text:TM("Yes please!"),click:function(){Crumb.ajax({type:"POST",url:"/band_follow_email_opt_in_cb",data:{address:t.email_address,band_id:t.band_id},dataType:"json",success:function(t){},error:function(t,n,e){},complete:function(){}}),$(this).dialog("close")}},{text:TM("No thanks"),click:function(){$(this).dialog("close")}}]),NuDialog.showTemplate("fan/band_follow_mailing_list_opt_in",{artist:t.band_name,label:t.label_name,email_address:t.email_address},{dialogClass:e,buttons:n})}function o(t,n,e,a){var o={type:"POST",url:t,data:n,dataType:"json",xhrFields:{withCredentials:!0}};a=a||function(){},Crumb.ajax(o).done((function(t){Trackpipe.showXHRError(t)?Log.error("XHR POST returned error JSON",t):(Log.note("XHR form submission succeeded with data",t),e(t))})).fail((function(t,n,e){if(Log.error("XHR POST failed",t,n,e),t.data)Trackpipe.showXHRError(t.data);else{var o=[];o.push({text:TM("OK"),click:function(t){$(this).dialog("close")}}),NuDialog.alert(TM("Network Error",null,"Dialog box title."),TM("There was a network error while processing your request. Please try again."),{buttons:o})}a()}))}t.followUnfollow=function(t,n,a){var i=$("#pagedata").data("blob")||{};null==t&&(t=FanData.fan_id);var l=$(a)[0];l||(l=$("#follow-unfollow_"+t)[0]);var r=$(l).hasClass("following")?"unfollow":"follow",s={fan_id:CurrentFan.fan_id,follow_id:t,action:r};!Identities.fan()||Identities.fan()&&!Identities.fan().verified?FanAction.doAction("follow",null,null,s.follow_id,"f",null,s):("undefined"!=typeof FROM_FANSUGGEST&&FROM_FANSUGGEST&&"follow"==r&&!e&&(s.from_fansuggest=!0,e=!0),$(l).toggleClass("following"),o("/fan_follow_cb",s,function(n){if(!n.ok){$(l).toggleClass("following");var e=[];e.push({text:TM("OK"),click:function(t){$(this).dialog("close")}});var a=n.reason;"read_only"===a&&(a="Fans are currently read only, please try to follow later"),NuDialog.alert(TM("Error",null,"Dialog box title."),a,{buttons:e})}if($("body").trigger("fan_"+r+"ed",[t]),!CurrentFan.is_following_any&&(!window.FanData||!FanData.is_own_page)&&"phone"==window.MediaView.mode&&i.mobile_app_compatible){CurrentFan.is_following_any=!0;var o=TM("Following!",null,"Title for dialog box suggesting the fan uses the bandcamp app."),s="";if(t==FanData.fan_id)s=FanData.name;else s=$.extend({},ItemCache.followers,ItemCache.following_fans)[t].name;var c={platform_app_url:i.platform_app_url,mobile_app_url:i.mobile_app_url,fan_name:s};NuDialog.showTemplate("fan/collection/fan_first_follow_pane",c,{width:"90%",title:o,buttons:{}})}}.bind({action:r}),function(){$(l).toggleClass("following")}.bind({action:r})),Stats.record({kind:"click",click:"fan_"+r}))},t.showMailingListDialog=a,t.followUnfollowBand=function(t){var n=$("#follow-unfollow-band_"+t)[0],e=$(n).hasClass("following")?"unfollow":"follow",i=FanData.fan_id,l={fan_id:CurrentFan.fan_id,follow_id:i,action:e};!Identities.fan()||Identities.fan()&&!Identities.fan().verified?FanAction.doAction("follow",null,null,null,null,t,l):(o("/fan_follow_band_cb",{fan_id:CurrentFan.fan_id,band_id:t,action:e},(function(e){if($(n).toggleClass("following"),e.is_following){var o=e.mailing_list_info;o.band_name=n.dataset.bandName,o.band_id=t,a(o)}})),Stats.record({kind:"click",click:"band_"+e}))},t.followUnfollowGenre=function(t){var n=$("#follow-unfollow-genre_"+t)[0],e=$(n).hasClass("following")?"unfollow":"follow";if($(n).toggleClass("following"),!$(n).hasClass("following")&&CurrentFan.fan_id==FanData.fan_id){$("#follow-grid-item-genre_"+t).remove();var a=$("#following-tabs li[data-tab='following-genres'] span.count"),o=Number(a.html());a.html(o-1)}var i={fan_id:CurrentFan.fan_id,follow_id:t,action:e};if(!Identities.fan()||Identities.fan()&&!Identities.fan().verified)FanAction.doAction("follow",null,null,t,"g",null,i);else{var l={action:e,discover_id:t},r=$.Deferred();Crumb.ajax({url:"/api/genrepreferences/1/fan_follow_genre",data:l,dataAs:"JSON",type:"POST",success:function(t){return t.ok?r.resolve(t):(Log.debug("failure response",t),r.reject(t))},error:function(t,n,e){return r.reject()}}),Stats.record({kind:"click",click:"fan_manage_genre_grid_"+e})}}}(Fanpage),function(t,n,e){"use strict";var a=["one-track-mind","default"],o=function(e){var a=this;a.isMouseDown=!1,a.charging=!1,a.firing=!1,a.mouseDownTime=null,a.rotation=0,a.sliderWidth=0,a.ballPosX=0,a.ballPosY=0,a.power=0,a.fireStartTime=null,a.animationTimer=null,a.sliderEl=n(".vol-slider",e.$el),a.iconEl=n(".vol-icon-wrapper",e.$el),a.ballEl=n(".vol-control",e.$el),a.startAnimation=function(){a.animationTimer||(a.animationTimer=setInterval((function(){var t,n,o,i,l=(new Date).getTime();if(a.charging||a.firing||l-a.mouseDownTime>150&&(a.charging=!0),a.charging&&!a.firing&&a.rotation<45&&(a.rotation+=1,a.iconEl.css("transform","rotate(-"+a.rotation+"deg)")),!a.charging&&a.firing){var r=l-a.fireStartTime;a.rotation>0&&(a.rotation-=a.degPerFrame,a.rotation<0&&(a.rotation=0),a.iconEl.css("transform","rotate(-"+a.rotation+"deg)")),a.ballPosX<a.destWidth&&(a.ballPosX=(t=r,n=0,o=a.xDiff,i=a.duration,o*t/i+n),a.ballPosX>a.xEnd&&(a.ballPosX=a.xEnd),a.ballEl.css("left",a.ballPosX+"px")),(r<a.yDurationUp||a.ballPosY<a.yEnd)&&(r<a.yDurationUp?a.ballPosY=function(t,n,e,a){return t/=a,e*(--t*t*t+1)+n}(r,a.yStart,a.yDiffUp,a.yDurationUp):(a.ballPosY=function(t,n,e,a){return e*(t/=a)*t*t+n}(r-a.yDurationUp,a.yStart-a.yCap,a.yDiffDown,a.yDurationDown),a.ballPosY>a.yEnd&&(a.ballPosY=a.yEnd)),a.ballEl.css("top",a.ballPosY+"px")),0===a.rotation&&a.ballPosY>=a.yEnd&&(a.firing=!1,e.volume(a.power/100),a.stopAnimation(),a.ballPosX=0,a.ballPosY=0,a.power=0,a.ballEl.removeClass("show"))}}),1e3/60))},a.stopAnimation=function(){clearInterval(a.animationTimer),a.animationTimer=null},a.mouseDown=function(){a.isMouseDown=!0,a.mouseDownTime=(new Date).getTime(),a.startAnimation(),a.sliderWidth=a.sliderEl.width()},a.mouseUp=function(){if(a.mouseDownTime){if((new Date).getTime()-a.mouseDownTime<150&&!a.firing)return a.charging=!1,a.firing=!1,a.stopAnimation(),e.toggleMute(),a.rotation=0,void a.iconEl.css("transform","rotate(-"+a.rotation+"deg)");a.charging&&(a.charging=!1,a.firing=!0,a.ballEl.addClass("show"),a.power=Math.floor(a.rotation*(100/45)),a.duration=4*a.power+20,a.destWidth=a.sliderWidth*(a.power/100),a.numFrames=Math.floor(a.duration/(1e3/60)),a.pxPerFrame=Math.floor(a.destWidth/a.numFrames),a.degPerFrame=a.rotation/a.numFrames,a.fireStartTime=(new Date).getTime(),a.yCap=.3*a.power,a.yStart=0,a.yEnd=1,a.xStart=0,a.xEnd=a.destWidth,a.ballPosX=a.xStart,a.xDiff=a.xEnd,a.ySwap=.55*a.duration,a.yDurationUp=a.ySwap,a.yDurationDown=a.duration-a.ySwap,a.ballPosY=a.yStart,a.yDiffUp=-a.yCap,a.yDiffDown=a.yCap)}},n(t).on("mouseup",(function(){a.mouseUp()}))};t.Player2=function(i,l,r,s){var c=this;function u(t){return"player2."+(c.playerId?c.playerId+".":"")+t}c.$el=n(i),c.playerId=r,s=s||{},c.currentTracklist=e.observableArray(),c.currentTrackIndex=e.observable(0),c.currentState=e.observable("idle"),-1==a.indexOf(s.mode)?c.mode=e.observable("default"):c.mode=e.observable(s.mode),c.currentTracklist.subscribe((function(){BCEvents.publish(u("tracklistChange"),{})})),c.currentTrack=e.computed((function(){var t=c.currentTracklist(),n=c.currentTrackIndex();return!t||0===t.length||void 0===n||n<0||n>t.length-1?null:t[n]})),c.currentState.subscribe((function(t){BCEvents.publish(u("stateChange"),{state:t,track:c.currentTrack()})})),c.showPlay=e.computed((function(){return"playing"!==c.currentState()&&"buffering"!==c.currentState()})),c.showPause=e.computed((function(){return"playing"===c.currentState()&&"buffering"!==c.currentState()})),c.showBusy=e.computed((function(){return"playing"!==c.currentState()&&"buffering"===c.currentState()})),c.canShowQueue=e.computed((function(){return"fan_collection"===l&&c.currentTracklist().length>1})),c.canShowVolume=e.observable(!0),c._playlist=new Player.Playlist(new WrapperSoundPlayer,l,null,{no_trackstate:!0,hq:!0}),c._playlist.onstatechanged((function(t){c.onStateChange(t)})),c._playlist.ontime((function(t){c.onTime(t)})),c._playlist.onloaded((function(t){c.onLoaded(t)})),c._playlist._player.setvol(1),c.duration=e.observable(),c.durationStr=e.computed((function(){var t=c.duration();return Time.timeStr(t>1?t:1)})),c.position=e.observable(),c.positionStr=e.computed((function(){return Time.timeStr(c.position())})),c.buffered=e.observable(),c.volume=e.observable(1),c.volume.subscribe((function(t){c._playlist._player.setvol(t)})),c.resetProgressBar=function(){["duration","position","buffered"].forEach((function(t){c[t](0)}))},c.progressBarWidth=e.computed((function(){var t=c.position(),n=c.duration();return t&&n&&0!==n?t/n*100+"%":"0%"})),c.bufferBarWidth=e.computed((function(){return c.buffered()+"%"})),c.seekToClientX=function(t){var e=n(".progress-bar",c.$el),a=e.offset().left,o=e.width(),i=t-a;i<0?i=0:i>o&&(i=o);var l=i/o;c.position(c.duration()*l)},c.seeking=e.observable(!1),c.seeking.subscribe((function(t){t?(BCEvents.publish(u("stats.click")),n(document).on("mousemove.seeking",(function(t){c.seekToClientX(t.originalEvent.clientX)}))):(n(document).off("mousemove.seeking"),c._playlist.seek(c.position()))})),c.clickSeek=function(t,n){BCEvents.publish(u("stats.click")),c.seekToClientX(n.clientX),c._playlist.seek(c.position())},n(document).on("mouseup",(function(){c.seeking(!1),c.volSliding(!1)})),c.setTracklist=function(t){if(JSON.stringify(t)===JSON.stringify(c.currentTracklist()))return!1;if("idle"!==c.currentState()&&c.stop(),c.resetProgressBar(),c.currentTracklist(t),c.currentTrackIndex(0),c.currentTrack()){var n=c.currentTrack().trackData;c._playlist.load([n]),c.duration(n.duration)}return!0},c.playPause=function(t){null==t&&(t=c.currentTrackIndex());var n=c.currentTrack(),e=c.currentTracklist()[t];return!!e&&(e===n?("playing"===c.currentState()?c.currentState("paused"):c.currentState("playing"),c._playlist.playpause(),FanControls.initializeItems(c.$el[0]),!0):(c.stop(),c.resetProgressBar(),c.currentTrackIndex(t),c._playlist.load([e.trackData]),c.duration(c.currentTrack().trackData.duration),c._playlist.playpause(),FanControls.initializeItems(c.$el[0]),!0))},c.playPauseClick=function(t){BCEvents.publish(u("stats.click")),BCEvents.publish(u("playPauseClick"),c.currentState()),c.playPause(t)},c.stop=function(){return c._playlist.pause(),c.currentState("paused"),!0},c.hasPrev=e.computed((function(){var t=c.currentTracklist(),n=c.currentTrackIndex();return t&&null!==n&&n>0})),c.hasNext=e.computed((function(){var t=c.currentTracklist(),n=c.currentTrackIndex();return t&&null!==n&&t.length-1>n})),c.setCurrentTrack=function(t){c.currentTrackIndex(t);var n=c.currentTrack();return c._playlist.load([n.trackData]),c.duration(c._playlist.duration()),!0},c.goToTrack=function(t){return c.stop(),c.resetProgressBar(),c.setCurrentTrack(t),c._playlist.playpause(),!0},c.prev=function(){return!!c.hasPrev()&&(BCEvents.publish(u("stats.click")),c.goToTrack(c.currentTrackIndex()-1))},c.next=function(){return!!c.hasNext()&&(BCEvents.publish(u("stats.click")),c.goToTrack(c.currentTrackIndex()+1))},c.getTracklist=function(){return c.currentTracklist()},c.getCurrentTrack=function(){return c.currentTrack()},c.queueVisible=e.observable(!1),c.toggleQueue=function(){BCEvents.publish(u("stats.click")),c.queueVisible(!c.queueVisible())},c.closeQueue=function(){c.queueVisible(!1)},c.queueNavigate=function(t){BCEvents.publish(u("stats.click")),t!==c.currentTrackIndex()?c.goToTrack(t):c.playPause()},c.volumeBarWidth=e.computed((function(){return 100*c.volume()+"%"})),c.volControlPos=e.computed((function(){return 100*c.volume()+"%"})),c.volSliding=e.observable(!1),c.volSliding.subscribe((function(t){t?(BCEvents.publish(u("stats.click")),n(document).on("mousemove.volSliding",(function(t){c.volToClientX(t.originalEvent.clientX)}))):n(document).off("mousemove.volSliding")})),c.volBeforeMute=e.observable(),c.toggleMute=function(){var t=c.volume();t>0?(c.volBeforeMute(t),c.volume(0)):c.volBeforeMute()?c.volume(c.volBeforeMute()):c.volume(1)},c.canShowVolume()&&(c.jokeVol=new o(c)),c.volMouseDown=function(){BCEvents.publish(u("stats.click")),c.jokeVol?c.jokeVol.mouseDown():c.toggleMute()},c.volToClientX=function(t){var e=n(".vol-slider",c.$el),a=e.offset().left,o=e.width(),i=t-a;i<0?i=0:i>o&&(i=o);var l=i/o;c.volume(l)},c.clickVol=function(t,n){BCEvents.publish(u("stats.click")),c.volToClientX(n.clientX)},c.tralbumUrlClick=function(){return BCEvents.publish(u("stats.click")),BCEvents.publish(u("tralbumUrlClick"),c.currentTrack()),!0},c.buyClick=function(){return BCEvents.publish(u("stats.click")),BCEvents.publish(u("buyClick"),c.currentTrack()),!0},c.giftClick=function(){return BCEvents.publish(u("stats.click")),BCEvents.publish(u("giftClick"),c.currentTrack()),!0},c.wishlistClick=function(){return BCEvents.publish(u("stats.click")),BCEvents.publish(u("wishlistClick"),c.currentTrack()),!0},c.onStateChange=function(t){if(t)switch(t.newstate){case"PAUSED":c.currentState("paused");break;case"BUFFERING":c.currentState("buffering");break;case"PLAYING":c.currentState("playing");break;case"COMPLETED":if(c.currentState("paused"),BCEvents.publish(u("trackEnded")),"one-track-mind"===c.mode())break;c.hasNext()?c.next():BCEvents.publish(u("tracklistEnded"))}},c.onTime=function(t){var n={};void 0!==t.position&&(n.position=t.position),void 0!==t.duration&&(n.duration=t.duration),BCEvents.publish(u("time"),n),c.seeking()||(void 0!==t.position&&c.position(t.position),void 0!==t.duration&&c.duration(t.duration))},c.onLoaded=function(t){c.buffered(isNaN(t)?0:t)},FanControls.delegate&&FanControls.delegate(c.$el),n(t).on("click",(function(t){c.queueVisible(!1)}))}}(window,jQuery,ko),function(t,n,e){"use strict";t.TrackItemVM=function(t,n,a){var o=this;o.playable=!0,o.playing=e.observable(!1),o.trackData={id:t.track_id,file:t.audio_url,duration:t.audio_track_duration},o.trackId=t.track_id,o.trackTitle=t.track_title,o.trackNumber=t.track_number,o.artist=t.artist,o.artId=t.art_id,o.artURL=ImageUtils.artURL(t.art_id,"art_app_large",!0),o.smallArtURL=ImageUtils.artURL(t.art_id,"art_thumbthumb",!0),o.bandUrl=n.band_url,o.tralbumUrl=n.tralbum_url,o.tralbumBuyUrl=Url.addQueryParams(n.tralbum_url,{action:"buy"}),o.bandId=n.band_id,o.playerId=n.player_id,o.tralbumKey=n.tralbum_key,o.parentTitle=n.title,o.parentTralbumType=n.parent_tralbum_type,o.goToThisTrack=function(){BCEvents.publish("daily.tracklistGoToTrack",{playerId:n.player_id,trackId:o.trackId})}}}(window,jQuery,ko),function(t,n,e){"use strict";t.ArticlePlayer=function(t){var a=this;a.playerInfo=t,a.featuredTrackNumber=t.featured_track_number,a.playerId=t.player_id,a.tralbumKey=t.tralbum_key,a.size=t.size,a.showTrack=t.show_track,a.bandId=t.band_id,a.parentTralbumType=t.parent_tralbum_type,a.parentTralbumId=t.parent_tralbum_id,a.followLoQuerystr=t.follow_lo_querystr,a.wishlistLoQuerystr=t.wishlist_lo_querystr,a.tracklist=[],t.tracklist.forEach((function(n){var e=new TrackItemVM(n,t,"");a.tracklist.push(e)}));var o=n("#daily-player-"+a.playerId)[0];a.player2=new Player2(o,"daily",a.playerId,{mode:"one-track-mind"}),a.player2.setTracklist(a.tracklist);var i=a.tracklist.findIndex((function(t){return t.trackNumber===a.featuredTrackNumber}));a.player2.setCurrentTrack(-1===i?0:i),a.$sidebar=n("#player-sidebar-"+a.playerId),a.$bigPlayerArt=n("#big-player-art-"+a.playerId),a.$mplayerArtist=n("#mplayer-artist-"+a.playerId),a.$topEl=function(){return a.$bigPlayerArt.is(":visible")?a.$bigPlayerArt:a.player2.$el},a.prev=function(){a.player2.mode("default"),a.player2.prev()},a.next=function(){a.player2.mode("default"),a.player2.next()};var l=a.$mplayerArtist.data("band-follow-info");a.followingBand=e.observable(l&&l.is_following),a.hasMPlayerArtist=function(){return a.$mplayerArtist.length>0},BCEvents.subscribe("fanSignup.logged_out_follow_new_signup_completes",(function(t){t.actionBandId===a.bandId&&a.followingBand(!0)})),a.toggleBandFollow=function(){if(!a.hasMPlayerArtist())return!1;var t,e=a.followingBand()?"unfollow":"follow";if("follow"===e&&BCEvents.publish((t="followClick","articlePlayer."+a.playerId+"."+t)),!Identities.fan()||Identities.fan()&&!Identities.fan().verified)FanAction.doAction("follow",a.followLoQuerystr,null,a.bandId,"b",a.bandId);else{var o={band_id:a.bandId,fan_id:Identities.fan()&&Identities.fan().id,action:e};Crumb.ajax({type:"POST",url:"/fan_follow_band_cb",data:o,dataType:Url.isCustomDomain()&&!n.support.cors?"jsonp":"json",xhrFields:{withCredentials:!0},success:function(t){if(t.ok&&(Log.note("band "+e+"ed"),a.followingBand(!a.followingBand()),t.is_following)){var n=t.mailing_list_info;n.band_name=a.playerInfo.band_name,n.band_id=a.playerInfo.band_id,Fanpage.showMailingListDialog(n)}},error:function(t,n,e){Log.error("XHR POST failed",t,n,e),a.followingBand(!a.followingBand())}})}},a.playerClasses=e.computed((function(){var t="";return t+="a"===a.player2.currentTrack().parentTralbumType?"album":"track",t+=" "+a.player2.currentState(),t+=a.showTrack?" show-track":""})),a.currMerchImageId=e.observable(),a.merchImageURL=e.computed((function(){var t=a.currMerchImageId();return t?ImageUtils.imageURL(t,"bio_screen"):null})),a.bigPlayerArtURL=e.computed((function(){return a.merchImageURL()||a.player2.currentTrack()&&a.player2.currentTrack().artURL})),a.changeBigPlayerArt=function(t,e){var o=n(e.target).data("image-id");a.currMerchImageId(o)},a.merchClasses=e.computed((function(){return!!n(a.player2.$el).hasClass("merch")&&"large"}))}}(window,jQuery,ko),function(t,n,e){"use strict";var a=function(a,o,i){var l,r=this;r.playerInfos=o,r.players=[],r.playerMap={},r.recordDailyStat=function(t,n){var e={article_id:a,event:t,logged_in:!!Identities.fan()};Identities.isAdmin()||(n&&navigator&&"function"==typeof navigator.sendBeacon?navigator.sendBeacon("/api/daily/1/record_stat",JSON.stringify(e)):BCAPI.call("Daily_1","record_stat",e))},o&&o.forEach((function(t){if(t){var n=new ArticlePlayer(t);r.players.push(n),r.playerMap[n.playerId]=n}})),r.currentPlayerIndex=e.observable(0),r.currentPlayer=e.computed((function(){var t=r.currentPlayerIndex();return void 0===t||t<0||t>r.players.length-1?null:r.players[t]})),r.players.forEach((function(t,n){var e="player2."+t.playerId+".",a="articlePlayer."+t.playerId+".";BCEvents.subscribe(e+"trackEnded",(function(){"one-track-mind"==t.player2.mode()&&r.hasNextPlayer()&&r.nextPlayer()})),BCEvents.subscribe(e+"tracklistEnded",(function(){r.hasNextPlayer()&&r.nextPlayer()})),BCEvents.subscribe(e+"stateChange",(function(t){"playing"===t.state&&(r.currentPlayerIndex(n),r.currentPlayerOnscreen(r.isCurrPlayerInView()),r.startedPlayback(!0))})),BCEvents.subscribe(e+"buyClick",(function(){r.recordDailyStat("buy")})),BCEvents.subscribe(e+"wishlistClick",(function(){r.recordDailyStat("wishlist")})),BCEvents.subscribe(e+"playPauseClick",(function(t){"idle"===t&&r.recordDailyStat("play")})),BCEvents.subscribe(a+"followClick",(function(){r.recordDailyStat("follow")}))})),BCEvents.subscribe("fanSignup.logged_out_follow_new_signup_completes",(function(){r.recordDailyStat("follow_signup")})),BCEvents.subscribe("fanSignup.logged_out_wishlist_new_signup_completes",(function(){r.recordDailyStat("wishlist_signup")})),Identities.fan()&&("bcd_f"===i?r.recordDailyStat("follow_signup"):"bcd_w"===i&&r.recordDailyStat("wishlist_signup")),BCEvents.subscribe("daily.tracklistGoToTrack",(function(t){var n=r.currentPlayer();if(n.playerId!=t.playerId){var e=r.players.findIndex((function(n){return n.playerId==t.playerId}));r.currentPlayerIndex(e),n=r.currentPlayer()}var a=n.tracklist.findIndex((function(n){return n.trackId==t.trackId}));n.player2.goToTrack(a)})),r.hasNextPlayer=e.computed((function(){var t=r.currentPlayerIndex();return null!==t&&r.players.length-1>t})),r.nextPlayer=function(){return!!r.hasNextPlayer()&&(r.currentPlayerIndex(r.currentPlayerIndex()+1),r.currentPlayer().player2.playPause(),!0)},r.startedPlayback=e.observable(!1),r.currentPlayerOnscreen=e.observable(!1),r.nowPlayingVisible=e.computed((function(){return r.startedPlayback()&&!r.currentPlayerOnscreen()})),r.scrollToCurrentPlayer=function(){n("html, body").animate({scrollTop:parseInt(r.currentPlayer().$topEl().offset().top-80)},1e3)},n(t).scroll((function(t){l=!0})),setInterval((function(){l&&(r.currentPlayerOnscreen(r.isCurrPlayerInView()),l=!1)}),100),r.isCurrPlayerInView=function(){if(!r.currentPlayer())return!1;var e=r.currentPlayer().player2.$el,a=n(t).scrollTop(),o=a+n(t).height();if(!e.offset())return!1;var i=e.offset().top;return i+e.height()<=o&&i>=a},r.adminBestOfBandcampDialog=function(){alert("This article's slug contains the text 'best-albums', so it is a candidate to be included in the Bandcamp Daily Newsletter the week the article is published, if the newsletter hasn't already been sent.")},r.adminDismissDialog=function(t,e){n(e.target).closest(".admin-banner").addClass("dismissed")}};n(document).ready((function(){var o=n("#s-daily #p-daily-article"),i=o.data("article-id"),l=new a(i,o.data("player-infos"),o.data("article-stats"));e.applyBindings(l,o[0]),o.find("a[data-clickthrough=true]").click((function(){return l.recordDailyStat("clickthrough",!0),!0})),PopupImage.delegate(o[0]),FanControls.initializeItems(o[0]),t.article=l}))}(window,jQuery,ko),void 0===window.Templ?Log.server("Premature template registration: trackpipe/template/fan/band_follow_mailing_list_opt_in.liquid","warn"):Templ.register({"fan/band_follow_mailing_list_opt_in":['<div class="heading">\n    ',{type:"ef",blocks:[{type:"ncondition",expression:"label ",attachment:["\n        ",{type:"translate",nodelist:["\n        You are now following ",{type:"translateVariable",var_name:"artist_name",nodelist:[{type:"variable",name:"artist",filters:[["h",[]]]}]}," and will receive a notification\n        whenever they release new music. Would you also like to join their mailing list, or their label’s mailing list?\n        "]},"\n    "]},{type:"else_ncondition",attachment:["\n        ",{type:"translate",nodelist:["\n        You are now following ",{type:"translateVariable",var_name:"artist_name",nodelist:[{type:"variable",name:"artist",filters:[["h",[]]]}]}," and will receive a notification\n        whenever they release new music. Would you also like to join their mailing list?\n        "]},"\n    "]}]},"\n</div>\n",{type:"ef",blocks:[{type:"ncondition",expression:"label ",attachment:['\n<div class="notify-me-container">\n    <div class="notify-me-inner first">\n        <label for="notify-me-band">\n            <input id="notify-me-band" name="notify-me-band" type="checkbox" data-bind="checked: false">\n            <div class="notify-me-message">',{type:"translate",nodelist:["Add me to the mailing list for ",{type:"translateVariable",var_name:"seller",nodelist:[{type:"variable",name:"artist",filters:[["h",[]]]}]},"."]},'</div>\n        </label>\n    </div>\n    <div class="notify-me-inner">\n        <label for="notify-me-label">\n            <input id="notify-me-label" name="notify-me-label" type="checkbox" data-bind="checked: false">\n            <div class="notify-me-message">',{type:"translate",nodelist:["Add me to the mailing list for ",{type:"translateVariable",var_name:"seller",nodelist:[{type:"variable",name:"label",filters:[["h",[]]]}]},"."]},"</div>\n        </label>\n    </div>\n</div>\n"]}]},'\n<div class="email-abuse">\n    ',{type:"translate",nodelist:["\n    Emails will be sent to ",{type:"translateVariable",var_name:"email_address",nodelist:[{type:"variable",name:"email_address",filters:[["h",[]]]}]},".\n    "]},"\n</div>\n"]});
